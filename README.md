# URL Status & PDF Report Service — 2025-12-02

## Примечание по срокам

В описании тестового задания было указано, что на выполнение **отводится 7 дней**,
но в чате HeadHunter уточнили срок **«не более 5 дней».**
При выполнении я ориентировался на меньший дедлайн.

---

## Краткое описание проекта
**Веб-сервис** принимает ссылки, проверяет их доступность, сохраняет наборы ссылок
и формирует PDF-отчёты по запросу.

---

## Технологии и стек
- **Go 1.23+**
- **Gin** — веб-фреймворк
- **gopdf** — генерация PDF
- **JSON-хранилище** для данных
- **sync.WaitGroup**, **channels** — конкурентность
- Поддержка **Graceful Shutdown**

---

## Основной функционал
### 1. Проверка ссылок

Пример запроса:

```json
{"links": ["google.com", "malformed.gg"]}
```


Сервис:
- проверяет каждый URL через worker pool,
- определяет статус (available / not available),
- сохраняет набор под уникальным номером (links_num),
- возвращает результат:

```json
{
  "links": {
    "google.com": "available",
    "malformed.gg": "not available"
  },
  "links_num": 1
}
```

### 2. Генерация PDF по номерам наборов

Пример запроса:

```json
{"links_list": [1, 2]}
```

Сервис:
- достаёт сохранённые данные из JSON-хранилища,
- формирует PDF-отчёт со статусами,
- отправляет PDF как бинарный файл.
Используется TTF-шрифт **DejaVu Sans.**

### 3. Graceful Shutdown

При получении SIGINT/SIGTERM сервис:
- ещё 3 секунды принимает задачи,
- закрывает очередь задач,
- ожидает завершения воркеров (WaitGroup),
- сохраняет хранилище на диск,
- корректно завершает работу без потери данных.

---

## Используемые паттерны
- **WorkerPool** — параллельная проверка URL
- **Handler Factory** — CheckURLs(...) gin.HandlerFunc, динамическая генерация хендлера
- **Dependency Injection** — для тестирования модуля storage
- **Delayed Graceful Shutdown** — корректное завершение сервиса

---

## Unit-тестирование

Unit-тестирование продемонстрировано на модуле **storage.**

Тесты соответствуют:
- **AAA-структуре** (Arrange–Act–Assert)
- **FIRST-принципам**
- использованию **мок-объектов**
- **табличным тестам**
- **Dependency Injection**

**Покрытые методы:**
- LoadFromDisk()
- SaveToDisk()

---

## Архитектура и структура проекта

Структура проекта подробно отображена в **Package Diagram**, расположенной по пути:

```
docs/diagrams/package_diagram.png
docs/diagrams/package_diagram.dia
```

Диаграмма отражает ключевые компоненты проекта и их ответственность.

### Основные пакеты
- **cmd/**  
  Точка входа приложения; запуск сервера и обработка graceful shutdown.
- **internal/check/**  
  Функция проверки доступности URL.
- **internal/handlers/**  
  HTTP-хендлеры для проверки ссылок и генерации PDF.
- **internal/pdf/**  
  Генерация PDF-отчётов.
- **internal/server/**  
  HTTP-сервер, маршруты, инициализация.
- **internal/service/**  
  Worker Pool для параллельной обработки задач.
- **internal/storage/**  
  In-memory хранилище, JSON-файл, Dependency Injection.

---

## UML Диаграммы

В рамках задания выполнены следующие диаграммы:
- **Use Case Diagram**
- **Activity Diagram**
- **Package Diagram**

Все материалы находятся в папке:

**docs/diagrams/**

Форматы:
- исходные файлы: .dia (созданы в программе **Dia**)
- скриншоты диаграмм

Каждая диаграмма размещена в **двух вариантах:**
1. **.dia** — редактируемый формат
2. **.png** — скриншот для быстрой проверки

---

## Запуск проекта

```bash
go run ./cmd/main.go
```

Сервис доступен по адресу:

http://localhost:8080

---

## Примеры HTTP-запросов
1. Проверка ссылок

**POST /check-links**

```json
{"links": ["google.com", "ya.ru"]}
```

2. Генерация PDF

**POST /make-pdf**

```json
{"links_list": [1, 2]}
```

---

## Ручное тестирование (Postman)

Выполнено end-to-end тестирование:
1. Проверка статусов ссылок
2. Генерация PDF по сохранённым наборам

Скриншоты находятся в:

docs/screenshots/


Файлы:
- check_links — успешная проверка
- make_pdf_01 — PDF по одному набору
- make_pdf_02 — PDF по нескольким наборам

Все тесты выполнялись на localhost:8080.